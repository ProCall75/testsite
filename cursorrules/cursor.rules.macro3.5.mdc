---
alwaysApply: true
---

RULESET â€” MACRO 3.5 (AUTH MINIMAL & REDIRECTIONS MINIMALES)

RÃ¨gles dâ€™exÃ©cution officielles â€” Strict Boundaries

â¸»

1. PÃ©rimÃ¨tre strict de Macro 3.5

Macro 3.5 traite uniquement :
	â€¢	Auth mockÃ©e (supabase-mock.ts)
	â€¢	AuthContext & Hooks (useAuth, useUser, useSession)
	â€¢	Guard (ClientAuthGuard)
	â€¢	Formulaires : Login, Signup, Logout
	â€¢	Redirections POST-ACTION minimales
	â€¢	Routing minimal basÃ© sur Ã©tat auth uniquement
	â€¢	Navigation entre pages marketing et app (haut niveau seulement)

Câ€™EST TOUT.

â¸»

2. Ce qui est STRICTEMENT INTERDIT dans Macro 3.5

Cursor NE DOIT PAS :

âŒ A. Parler, analyser ou implÃ©menter Onboarding

Interdit de rÃ©fÃ©rencer :
	â€¢	onboarding incomplet / complet
	â€¢	steps onboarding
	â€¢	logique first login
	â€¢	wizard
	â€¢	progression
	â€¢	state machine onboarding
	â€¢	isNewUser, isOnboardingComplete

âŒ B. Parler ou implÃ©menter la logique produit avancÃ©e

Interdit de rÃ©fÃ©rencer :
	â€¢	routes conditionnelles selon les donnÃ©es mock
	â€¢	conditions mÃ©tier (ex : salon complet / incomplet)
	â€¢	dashboard logique ou ses donnÃ©es
	â€¢	settings logique

âŒ C. Modifier ou analyser le contenu des pages (app)

Cursor NE DOIT PAS :
	â€¢	lire ou interprÃ©ter /dashboard/page.tsx
	â€¢	lire ou interprÃ©ter /onboarding/page.tsx
	â€¢	inspecter / analyser UI
	â€¢	analyser des Domain Models
	â€¢	tirer des conclusions produit

âŒ D. Ajouter des Ã©tats auth qui nâ€™existent pas

Interdit de crÃ©er ou mentionner :
	â€¢	isNewUser
	â€¢	isOnboardingComplete
	â€¢	clientReady
	â€¢	firstLogin

âŒ E. ImplÃ©menter des redirections avancÃ©es

Interdit :
	â€¢	login â†’ onboarding
	â€¢	signup â†’ onboarding
	â€¢	onboarding â†’ dashboard
	â€¢	fallback produit
	â€¢	redirections basÃ©es sur mock data

â¸»

3. Ce que Macro 3.5 DOIT implÃ©menter (et uniquement Ã§a)

âœ” A. Redirections AUTH minimales

Ã€ la fin de la macro, le systÃ¨me auth doit permette uniquement :
	â€¢	login â†’ /dashboard
	â€¢	signup â†’ /login
	â€¢	logout â†’ /login
	â€¢	guard (non-auth) â†’ /login

Aucune autre route cible.

âœ” B. Guard complÃ©tÃ©

Guard = protection de route uniquement basÃ©e sur :
	â€¢	loading
	â€¢	session
	â€¢	user

Pas dâ€™autres conditions.

âœ” C. Routing Contract minimal (Phase 3.5.2)

Le contrat doit dÃ©finir :
	â€¢	routes publiques : /, /login, /signup, marketing
	â€¢	routes protÃ©gÃ©es : tout (app)
	â€¢	rÃ¨gles auth minimales

Et rien dâ€™autre.

â¸»

4. Ce que Macro 3.5 peut analyser (autorisÃ©)

Cursor peut lire et analyser :
	â€¢	/lib/auth/*
	â€¢	/app/(marketing)/*
	â€¢	/app/(app)/layout.tsx uniquement pour vÃ©rifier prÃ©sence du guard
	â€¢	/app/(app)/dashboard uniquement pour vÃ©rifier que la route existe (cible de login)

Il ne doit pas analyser leur contenu fonctionnel.

â¸»

5. Ce que Macro 3.5 doit produire comme livrables

Phase 3.5.1 â€” Audit SOCLE AUTH
	â€¢	uniquement ce qui concerne auth mockÃ©e
	â€¢	pas de mention onboarding
	â€¢	pas de mention produit
	â€¢	pas de mention logique mÃ©tier

Phase 3.5.2 â€” Routing Contract minimal
	â€¢	login â†’ dashboard
	â€¢	signup â†’ login
	â€¢	logout â†’ login
	â€¢	guard (non-auth) â†’ login
	â€¢	distinction public/protected
	â€¢	rien dâ€™autre

Phase 3.5.3 â€” ImplÃ©mentation

ImplÃ©menter le contrat minimal, sans anticiper:
	â€¢	onboarding
	â€¢	logique produit
	â€¢	routing avancÃ©
	â€¢	state machine

Phase 3.5.4 â€” Validation

Tester uniquement :
	â€¢	login â†’ dashboard
	â€¢	signup â†’ login
	â€¢	logout â†’ login
	â€¢	guard non-auth â†’ login
	â€¢	refresh route protÃ©gÃ©e â†’ login

Phase 3.5.5 â€” Refactor lÃ©ger
	â€¢	nettoyages auth
	â€¢	rien dâ€™autre

â¸»

6. VÃ©rification obligatoire avant toute sortie

Cursor doit vÃ©rifier que :
	â€¢	aucune mention onboarding nâ€™apparaÃ®t
	â€¢	aucune logique produit nâ€™apparaÃ®t
	â€¢	aucune route avancÃ©e nâ€™est incluse
	â€¢	aucune anticipation inter-macro nâ€™est prÃ©sente
	â€¢	les redirections sont strictement celles demandÃ©es
	â€¢	le code nâ€™ajoute aucun nouvel Ã©tat
	â€¢	le pÃ©rimÃ¨tre reste auth-only

Si une de ces conditions est violÃ©e â†’ Cursor doit corriger avant de produire la sortie.

â¸»

7. Raison dâ€™Ãªtre de Macro 3.5 (pour Ã©viter les dÃ©rives)

Objectif unique de Macro 3.5 :
Faire fonctionner la boucle auth complÃ¨te : login â†’ guard â†’ page protÃ©gÃ©e.

Ni onboarding, ni logique produit, ni routing mÃ©tier.

â¸»

Check

âœ” CohÃ©rent avec Tampon STADE MACRO 3.5
âœ” Conforme au sÃ©quenÃ§age Alfred
âœ” Interdit formel dâ€™onboarding / produit
âœ” 100% exÃ©cutable par Cursor
âœ” PrÃ©pare parfaitement Macro 3.5.2

â¸»

Si tu veux, je peux aussi te prÃ©parer :

ğŸ“Œ La version en markdown prÃªte Ã  coller dans Cursor,
ğŸ“Œ La To-Do 3.5.2 conforme Ã  ces rÃ¨gles,
ğŸ“Œ Ou un test â€œanti-anticipationâ€ que Cursor doit exÃ©cuter avant chaque phase.